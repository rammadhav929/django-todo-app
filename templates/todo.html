<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <title>Django ToDo page</title>
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
  </head>

  <body class="bg-light">
    <div class="container mt-5">
      <h1 class="text-center mb-4">Django To Do Page</h1>
      <hr />
      <h2>Today Day</h2>
      <p>{% now "jS F Y" %}</p>

      <div class="row">
        <!-- LEFT SIDE (FORM) -->
        <div class="col-md-6">
          <form method="POST">
            <!-- âœ… FIXED QUOTES -->
            {% csrf_token %}
            <h4>Write what you want to do...</h4>
            <input
              type="text"
              name="user_message"
              class="form-control"
              required
            />
            <button type="submit" class="btn btn-success mt-3">Submit</button>
          </form>
          <!-- ðŸ›‘ FORM CLOSED HERE -->
        </div>

        <!-- RIGHT SIDE (TASK LIST) -->
        <div class="col-md-6 mt-0">
          <h4>Todo List:</h4>
          <div class="border rounded p-3 bg-white">
            <ol>
              {% if tasks %} {% for t in tasks %}
              <li
                class="d-flex justify-content-between align-items-center bg-light p-2 rounded mb-2"
              >
                <span id="task-text-{{ t.id }}">
                  {{ t.task }}
                  <small style="margin-left: 50px">
                    ({{ t.created_at|date:"d M Y" }})
                  </small>
                </span>
                <div>
                  <a
                    href="{% url 'delete_task' t.id %}"
                    class="btn btn-danger btn-sm me-1"
                    >Delete</a
                  >
                  <button
                    onclick="editTask({{ t.id }})"
                    class="btn btn-success btn-sm"
                  >
                    Edit
                  </button>
                </div>
              </li>
              {% endfor %} {% else %}
              <p>No tasks added yet.</p>
              {% endif %}
            </ol>
          </div>
        </div>
      </div>
    </div>

    <script>
      function editTask(id) {
        const taskText = document.getElementById(`task-text-${id}`);
        const currentText = taskText.innerText.trim();

        taskText.innerHTML = `
          <form action="/update_task/${id}/" method="POST">
            {% csrf_token %}
            <input type="text" name="task" value="${currentText}" class="form-control form-control-sm d-inline" style="width: 60%;">
            <button type="submit" class="btn btn-primary btn-sm">Save</button>
          </form>
        `;
      }
    </script>
  </body>
</html>
